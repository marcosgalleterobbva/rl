# =========================
# minari_discrete_config.yaml
# =========================

# --- Hydra runtime behavior ---
hydra:
  job:
    chdir: true   # keep the old behavior and silence the warning

# -------- env and task --------
env:
  backend: minari           # env is reconstructed from the Minari dataset
  task: ""
  library: minari
  n_samples_stats: 1000

# -------- offline replay buffer --------
replay_buffer:
  env: BabyAI-UnlockLocal-v0
  dataset: "minigrid/BabyAI-UnlockLocal/optimal-v0"
  batch_size: 128
  episodes: 10000

logger:
  backend: wandb
  project_name: torchrl_example_cql
  group_name: null
  exp_name: cql_${replay_buffer.dataset}
  mode: online
  video: true
  eval_envs: 1
  eval_iter: 5000
  eval_steps: 1000

# -------- model (Q-network / policy) --------
model:
  hidden_sizes: [256, 256]
  mission_emb_dim: 32
  dueling: false
  layer_norm: false
  activation: "relu"
  state_key: "observation"
  action_key: "action"
  value_key: "state_value"
  ortho_init: true
  verb_emb_dim: 16
  noun_emb_dim: 16
  color_emb_dim: 8
  mission_combiner: "concat"   # or "sum"
  concat:
    image_key: image
    extra_keys: []        # was [mission]
    out_key: obs_vec
    normalize_uint8_image: false
    normalize_uint8_extras: false

# -------- loss (CQL + DQN bits) --------
loss:
  action_space: "categorical"
  gamma: 0.99
  tau: 0.005
  double_dqn: true
  loss_function: "l2"      # <- explicit for DiscreteCQLLoss
  cql:
    alpha: 1.0
    temperature: 1.0
    with_lagrange: false
    target_action_gap: 0.0
    n_action_samples: null
  reduction: "mean"

# -------- collector knobs used by make_discretecql_model (Îµ-greedy anneal) --------
collector:
  annealing_frames: 100000
  eps_start: 1.0
  eps_end: 0.05

# -------- optimization --------
optim:
  seed: 0
  device: ""               # auto: cuda:0 if available, else cpu
  gradient_steps: 100000
  policy_eval_start: 10000
  lr: 3e-4
  weight_decay: 0.0
  eps: 1.0e-8
  max_grad_norm: null

# -------- compile / speedups --------
compile:
  compile: false
  compile_mode: null       # "reduce-overhead" | "max-autotune" | "default"
  cudagraphs: false
